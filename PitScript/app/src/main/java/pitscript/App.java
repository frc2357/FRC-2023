/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package pitscript;
import java.util.List;

import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.JSchException;
import com.jcraft.jsch.Session;
import com.jcraft.jsch.SftpException;




public class App {
    
    public String remoteHost = "10.223.57.2";
public String username = "admin";
public String password = "";
static App m_main;
static MakeFileList m_fileLister = new pitscript.MakeFileList().getInstance();
static JschSocketFactory m_socketFactory = new pitscript.JschSocketFactory().getInstance();
static Session m_jSession;
    public static void main(String[] args) {
        App main = new App();
        m_main = main;
        try {
            ChannelSftp channelSftp = m_main.setupJsch();
            try {
                channelSftp.get("/lvuser/logs/","C:\\Logs");
            } catch (SftpException e) {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }
        } catch (JSchException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        // try {
        //     main.downloadFile();
        // } catch (JSchException | SftpException e ) {
        //     System.out.println("it didnt download the file");
        //     e.printStackTrace();
        // }
    }
    private ChannelSftp setupJsch() throws JSchException {
        JSch jsch = new JSch();
        Session jschSession = jsch.getSession(username, remoteHost);
        m_jSession = jschSession;
        jschSession.setPassword(password);
        jschSession.connect();
        jschSession.setSocketFactory(m_socketFactory);
        sendKeepAliveMsg();
        return (ChannelSftp) jschSession.openChannel("sftp");
    }
    public void downloadFile() throws JSchException, SftpException{
        String remoteFile = "/home/lvuser/logs";
        String localDir = "C:\\Logs";
    
    ChannelSftp channelSftp = setupJsch();

    List<String>fileList = m_fileLister.getFileList(remoteFile,channelSftp);
        for(String filePath : fileList){
        channelSftp.get(filePath, localDir);
        }
    System.out.println("it worked :)");
    channelSftp.exit();
}
public void sendKeepAliveMsg(){
    try {
        m_jSession.sendKeepAliveMsg();
    } catch (Exception e) {
        System.out.println("didnt send the keep alive message.");
        e.printStackTrace();
    }
}

}
    